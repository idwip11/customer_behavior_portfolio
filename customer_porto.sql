select * from customer limit 25;

SELECT VERSION();

-- what is the total revenue generated by male vs. female customers?
select gender, sum(purchase_amount) as revenue
from customer group by gender;

-- which customers used a discount but still spent more than the average purchase amount?
select customer_id, purchase_amount
from customer where discount_applied = 'yes'and purchase_amount >= (select avg(purchase_amount) from customer);

-- which are the top 5 products with the highest average review rating? 
select item_purchased, avg(review_rating) as "average product rating"
from customer group by item_purchased order by avg(review_rating) desc limit 5;

-- compare the average purchase amounts between standard and express shipping   
select shipping_type, round (avg(purchase_amount),2)
from customer where shipping_type in ('Standard', 'Express')
group by shipping_type;

-- do subscriber customer spend more? compare average spend and total revenue betweem subsribers and non-subsribers
select subscription_status, count(customer_id) as total_customers,
round(avg(purchase_amount),2) as avg_spend,
round(sum(purchase_amount),2) as total_revenue
from customer
group by subscription_status
order by total_revenue, avg_spend desc;

-- which 5 products have the highest percentage of purchases with discounts applied?
select item_purchased,
round(sum(case when discount_applied = 'yes' then 1 else 0 end)/count(*)*100,2) as discount_rate
from customer
group by item_purchased
order by discount_rate desc limit 5;

-- segment customer into new, returning, and loyal based on their total number
-- of previous purchases, and show the count of each segment
with customer_type as (
select customer_id, previous_purchases,
case 
	when previous_purchases = 1 then 'New'
    when previous_purchases between 2 and 10 then 'Returning'
    else 'loyal'
    end as customer_segment
from customer)
select customer_segment type, count(*) as "Number of Customer"
from customer_type
group by customer_segment;

-- what are the top 3 most purchased products within each category?
 with item_count as (
 select category, item_purchased, count(customer_id) as total_orders,
 row_number() over(partition by category order by count(customer_id) desc) as item_rank 
 from customer
 group by category, item_purchased
 )
 select item_rank, category, item_purchased, total_orders
 from item_count
 where item_rank <=3;
 
-- are customer who are repeat buyers (more than 5 previous purchases) also likely to subsribe?
select subscription_status, count(customer_id) as repeat_buyers
from customer
where previous_purchases >= 5 group by subscription_status;

-- what is the revenue contribution of each age group
select age_group, sum(purchase_amount) as total_revenue
from customer 
group by age_group
order by total_revenue;

-- ip address: 192.168.1.3:3306
-- username: powerbi
-- pass: passwordkuat123

--
CREATE USER 'powerbi'@'%' IDENTIFIED BY 'passwordkuat123';
GRANT ALL PRIVILEGES ON customer_behavior.* TO 'powerbi'@'%';
FLUSH PRIVILEGES;
SELECT host, user FROM mysql.user WHERE user='powerbi';
SHOW VARIABLES LIKE 'bind_address';



 